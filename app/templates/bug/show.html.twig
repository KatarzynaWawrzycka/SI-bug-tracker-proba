{% extends 'base.html.twig' %}

{% block title %}
    {{ 'title.bug_details'|trans({'%id%': bug.id|default('')}) }}
{% endblock %}

{% block body %}
    <h1 class="mb-4">{{ 'title.bug_details'|trans({'%id%': bug.id|default('')}) }}</h1>


    {% if bug is defined %}
        <div class="mt-4">
            <a href="{{ url('bug_index') }}" class="btn btn-outline-secondary">
                {{ 'action.back_to_list'|trans }}
            </a>
        </div>

        <div class="bug-details border rounded p-4 mb-5 bg-white shadow-sm flex-column w-50">
            <div class="mb-4 flex-row">
                <div class="fw-bold d-block mb-1">{{ 'label.author'|trans }}</div>
                <div>{{ bug.author.email }}</div>
                <div class="fw-bold d-block mb-1">{{ 'label.id'|trans }}</div>
                <div>{{ bug.id }}</div>
                <div class="fw-bold d-block mb-1">{{ 'label.created_at'|trans }}</div>
                <div>{{ bug.createdAt|format_date('long') }}</div>
                <div class="fw-bold d-block mb-1">{{ 'label.updated_at'|trans }}</div>
                <div>{{ bug.updatedAt|format_date('long') }}</div>
            </div>
            <hr>
            <div class="mb-4 flex-column">
                <div class="fw-bold d-block mb-1">{{ 'label.title'|trans }}</div>
                <div>{{ bug.title }}</div>
                <div class="fw-bold d-block mb-1">{{ 'label.description'|trans }}</div>
                <div>{{ bug.description }}</div>
                <div class="fw-bold d-block mb-1">{{ 'label.category'|trans }}</div>
                <div>{{ bug.category.title }}</div>
            </div>
            <hr>
            <div class="mb-4">
                <div class="fw-bold d-block mb-1">{{ 'label.tags'|trans }}</div>
                <div>{{ bug.tags|map(tag => tag.title)|join(', ') }}</div>
            </div>
        </div>

        <h2 class="mb-3">{{ 'label.comments'|trans }}</h2>
        {% if is_granted('IS_AUTHENTICATED_FULLY') %}
            <a href="{{ path('bug_comment', {'id': bug.id}) }}" class="btn btn-success mt-3">
                {{ 'action.add_comment'|trans }}
            </a>
        {% endif %}

        {% if comments is defined and comments|length > 0 %}
            <div class="comments-section">
                {% for comment in comments %}
                    <div class="comment border rounded p-3 mb-3 bg-light">
                        <div class="mb-1 text-muted small">
                            <strong>{{ comment.author.email }}</strong><br>
                            {{ comment.updatedAt|format_datetime('medium') }}
                        </div>
                        <hr class="my-2">
                        <div class="comment-content">
                            {{ comment.content }}
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-muted">{{ 'label.no_comments'|trans }}</p>
        {% endif %}

    {% else %}
        <p class="alert alert-warning">{{ 'message.record_not_found'|trans }}</p>
    {% endif %}
{% endblock %}
